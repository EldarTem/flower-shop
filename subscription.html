<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Цветочная подписка — Roses from Edem</title>

    <link rel="stylesheet" href="assets/css/base.css" />
    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="stylesheet" href="assets/libs/swiper/swiper-bundle.min.css" />
    <link rel="stylesheet" href="assets/css/product-card.css" />
    <link rel="stylesheet" href="assets/css/cart.css" />
    <link
      rel="icon"
      href="/assets/images/icons/favicon.svg"
      type="image/svg+xml"
    />
  </head>
  <body>
    <!-- header -->
    <div id="header-placeholder"></div>

    <main class="container subscription">
      <h1 class="subscription__title">ЦВЕТОЧНАЯ ПОДПИСКА</h1>

      <!-- Пиллы-навигации -->
      <nav class="subs-nav" aria-label="Типы подписки">
        <a class="chip is-active" href="#home">Для дома</a>
        <a class="chip" href="#office">Для офиса</a>
        <a class="chip" href="#gift">В подарок</a>
      </nav>

      <!-- Блок 1 — Для дома -->
      <section id="home" class="sub-block">
        <h2 class="sub-block__title">Для дома</h2>

        <div class="sub-block__grid">
          <figure class="sub-block__media">
            <img
              src="assets/images/izobr/cert-1-1.jpg"
              alt="Подписка: букет для дома"
            />
          </figure>

          <div class="sub-block__content">
            <p>
              Цветочная подписка — это удобный сервис регулярной доставки
              букетов из свежих сезонных цветов прямо к вам домой в течение
              месяца (4 недели).
            </p>
            <p>
              Эта подписка идеально подойдёт тем, кто хочет наслаждаться
              красотой и свежестью цветов на протяжении всего месяца, создать
              уютную атмосферу дома или добавить яркие акценты в пространство.
            </p>
            <p>
              Мы предложим вам только свежие цветы, учитывая ваши предпочтения и
              выбранные цветовой гаммы и сортов, чтобы каждую неделю вы
              радовались новой уникальной композиции. Вы также можете сообщить
              время, место, адрес доставки, чтобы сделать получение максимально
              удобным.
            </p>
            <p>
              Для расчёта стоимости подписки, оставьте свои данные, и наш
              администратор свяжется с вами в ближайшее время для обсуждения
              всех деталей.
            </p>

            <form class="sub-form" action="#" method="post">
              <input
                class="pill-input"
                type="text"
                name="name"
                placeholder="Ваше имя"
                required
              />
              <input
                class="pill-input"
                type="tel"
                name="phone"
                placeholder="Телефон"
                required
              />
              <button class="btn btn--primary btn--xl" type="submit">
                Заказать
              </button>
            </form>
          </div>
        </div>
      </section>

      <!-- Блок 2 — Для офиса (картинка справа) -->
      <section id="office" class="sub-block sub-block--reverse">
        <h2 class="sub-block__title">Для офиса</h2>

        <div class="sub-block__grid">
          <figure class="sub-block__media">
            <img
              src="assets/images/izobr/cert-2-2.jpg"
              alt="Подписка: букет для офиса"
            />
          </figure>

          <div class="sub-block__content">
            <p>
              Подписка на офис освобождает время и экономит бюджет. Вам не нужно
              постоянно заниматься поиском, выбором и подбором цветов.
            </p>
            <p>
              Цветы по подписке всегда будут свежими, без резких перепадов
              качества. При оформлении первого заказа вы можете выбрать тип
              букета и периодичность доставок. Мы будем доставлять вам цветы по
              расписанию.
            </p>
            <p>
              При оформлении корпоративных подписок возможен нанесение на
              постоянной основе нашей брендированной ленты на вазы; при больших
              объёмах и сроках — скидки.
            </p>
            <form class="sub-form" action="#" method="post">
              <input
                class="pill-input"
                type="text"
                name="name"
                placeholder="Ваше имя"
                required
              />
              <input
                class="pill-input"
                type="tel"
                name="phone"
                placeholder="Телефон"
                required
              />
              <button class="btn btn--primary btn--xl" type="submit">
                Заказать
              </button>
            </form>
          </div>
        </div>
      </section>

      <!-- Блок 3 — В подарок -->
      <section id="gift" class="sub-block">
        <h2 class="sub-block__title">Подарочный сертификат</h2>

        <div class="sub-block__grid">
          <figure class="sub-block__media">
            <img
              src="assets/images/izobr/cert-3-1.jpg"
              alt="Подарочный сертификат на цветочную подписку"
            />
          </figure>

          <div class="sub-block__content">
            <p>
              <strong>Универсальный подарок</strong> — сертификат подойдёт для
              любого повода: день рождения, юбилей, свадьба или знак внимания.
            </p>
            <p><strong>Как оформить сертификат?</strong></p>
            <p>
              1) Определите желаемую сумму сертификата от 3 000 ₽ или срок
              подписки. <br />
              2) Укажите данные получателя и свои пожелания. <br />
              3) Мы подготовим красивый сертификат, который можно вручить лично
              или отправить по почте.
            </p>
            <p>
              Оставьте контакты — администратор свяжется и подберёт оптимальный
              вариант.
            </p>
            <form class="sub-form" action="#" method="post">
              <input
                class="pill-input"
                type="text"
                name="name"
                placeholder="Ваше имя"
                required
              />
              <input
                class="pill-input"
                type="tel"
                name="phone"
                placeholder="Телефон"
                required
              />
              <button class="btn btn--primary btn--xl" type="submit">
                Заказать
              </button>
            </form>
          </div>
        </div>
      </section>
    </main>

    <!-- footer -->
    <div id="footer-placeholder"></div>

    <button id="to-top" class="to-top" type="button" aria-label="Наверх">
      <img src="assets/images/icons/arrowLeft.svg" alt="" />
    </button>

    <script src="assets/libs/swiper/swiper-bundle.min.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/cart.js"></script>
    <script>
      /* ===== Плавный скролл для чипов ===== */
      function smoothScrollTo(targetY, duration = 700) {
        const startY = window.scrollY || document.documentElement.scrollTop;
        const diff = targetY - startY;
        if (Math.abs(diff) < 2) return;
        const ease = (t) =>
          t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
        const t0 = performance.now();
        requestAnimationFrame(function raf(now) {
          const p = Math.min(1, (now - t0) / duration);
          window.scrollTo(0, startY + diff * ease(p));
          if (p < 1) requestAnimationFrame(raf);
        });
      }

      /* ===== Навигация-чипы: клик + автоподсветка ===== */
      (function initSubsChips() {
        const chips = [...document.querySelectorAll(".subs-nav .chip")];
        if (!chips.length) return;

        chips.forEach((chip) => {
          chip.addEventListener("click", (e) => {
            const id = chip.getAttribute("href");
            const target = document.querySelector(id);
            if (!target) return;
            e.preventDefault();
            history.pushState(null, "", id);
            chips.forEach((c) => c.classList.toggle("is-active", c === chip));
            const top =
              target.getBoundingClientRect().top + window.scrollY - 16;
            smoothScrollTo(top, 700);
          });
        });

        const sections = [...document.querySelectorAll(".sub-block")];
        const io = new IntersectionObserver(
          (entries) => {
            const vis = entries
              .filter((en) => en.isIntersecting)
              .sort((a, b) => b.intersectionRatio - a.intersectionRatio)[0];
            if (!vis) return;
            const id = "#" + vis.target.id;
            chips.forEach((c) =>
              c.classList.toggle("is-active", c.getAttribute("href") === id)
            );
            history.replaceState(null, "", id);
          },
          { threshold: [0.5] }
        );
        sections.forEach((s) => io.observe(s));
      })();

      /* ===== Телефон: прогрессивная маска + валидация ===== */
      (function initPhoneMask() {
        const forms = [...document.querySelectorAll(".sub-form")];
        if (!forms.length) return;

        const digitsOnly = (v) => (v || "").replace(/\D+/g, "");

        // Нормализация под РФ для live-форматирования:
        // всегда считаем, что страна = 7, 8 -> 7, остальное идёт как "остальные 10"
        function normalizeForFormat(raw) {
          let d = digitsOnly(raw);
          if (!d) return "";
          if (d[0] === "8") d = d.slice(1); // отбрасываем 8
          if (d[0] === "7") d = d.slice(1); // убираем 7 из тела номера
          return ("7" + d).slice(0, 11); // 7 + до 10 цифр
        }

        // Форматируем постепенно: +7, +7 (9, +7 (97, ... +7 (978) 8, ... +7 (978) 897-5, ...
        function formatRuProgressive(normalized) {
          if (!normalized) return "";
          const c = normalized[0]; // всегда '7'
          const rest = normalized.slice(1); // до 10 цифр
          let out = "+" + c;
          if (rest.length >= 1)
            out += " (" + rest.slice(0, Math.min(3, rest.length));
          if (rest.length >= 3) out += ")";
          if (rest.length >= 4)
            out += " " + rest.slice(3, Math.min(6, rest.length));
          if (rest.length >= 6)
            out += "-" + rest.slice(6, Math.min(8, rest.length));
          if (rest.length >= 8)
            out += "-" + rest.slice(8, Math.min(10, rest.length));
          return out;
        }

        // Валидация: ровно 11 цифр общего номера и начинается на 7
        function isValidFull(raw) {
          let d = digitsOnly(raw);
          if (!d) return false;
          if (d[0] === "8") d = "7" + d.slice(1);
          if (d[0] !== "7" && d.length === 10) d = "7" + d; // если ввели 10 цифр без 7
          return d.length === 11 && d[0] === "7";
        }

        // UI-ошибки
        function setError(input, msg) {
          if (!input) return;
          input.classList.add("input-error");
          let hint = input.nextElementSibling;
          if (!hint || !hint.classList.contains("form-error")) {
            hint = document.createElement("div");
            hint.className = "form-error";
            input.insertAdjacentElement("afterend", hint);
          }
          hint.textContent = msg;
        }
        function clearError(input) {
          if (!input) return;
          input.classList.remove("input-error");
          const hint = input.nextElementSibling;
          if (hint && hint.classList.contains("form-error")) hint.remove();
        }

        forms.forEach((form) => {
          const name = form.querySelector('input[name="name"]');
          const phone = form.querySelector('input[name="phone"]');
          const btn = form.querySelector('button[type="submit"]');
          if (!phone) return;

          // live-маска
          function reformat() {
            const norm = normalizeForFormat(phone.value);
            phone.value = formatRuProgressive(norm); // скобки/дефисы появляются по мере ввода
            clearError(phone);
          }
          phone.addEventListener("input", reformat);

          // корректная вставка
          phone.addEventListener("paste", (e) => {
            e.preventDefault();
            const text = (e.clipboardData || window.clipboardData).getData(
              "text"
            );
            const norm = normalizeForFormat(text);
            phone.value = formatRuProgressive(norm);
          });

          // на blur: если пусто — очищаем до "", если неполный — подсветим ошибку
          phone.addEventListener("blur", () => {
            clearError(phone);
            if (!digitsOnly(phone.value)) {
              phone.value = "";
              return;
            }
            if (!isValidFull(phone.value))
              setError(phone, "Введите номер в формате +7 (XXX) XXX-XX-XX");
          });

          // Сабмит (один! дубликатов нет)
          form.addEventListener("submit", (e) => {
            e.preventDefault();
            clearError(name);
            clearError(phone);

            let ok = true;
            if (!name?.value.trim()) {
              setError(name, "Укажите имя");
              ok = false;
            }
            if (!isValidFull(phone.value)) {
              setError(phone, "Проверьте номер телефона");
              ok = false;
            }
            if (!ok) return;

            // имитация отправки
            btn.disabled = true;
            const prev = btn.textContent;
            btn.textContent = "Отправляем…";

            setTimeout(() => {
              btn.disabled = false;
              btn.textContent = prev;
              form.reset();
              showToast?.(
                "Заявка отправлена. Мы свяжемся с вами в ближайшее время."
              );
            }, 900);
          });
        });
      })();
    </script>
  </body>
</html>
